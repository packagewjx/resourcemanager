# 汇编知识集合

## AT&T汇编语言语法总结

### 命令后缀

- `b`: byte = 8 bit
- `w`: word = 16 bit
- `d`: double word
- `q`: quad word
- `l`: double word

### 操作数

- `$`开头为字面值
- `%`开头为寄存器
- 无前缀的数字为内存地址
- 括号包含者内存取值，见下方

### 内存取址

完整格式：`segment-override:signed-offset(base,index,scale)`

#### 样例

|GAS memory operand|NASM memory operand|
|------------------|-------------------|
|100               |[100]              |
|%es:100           |[es:100]           |
|(%eax)            |[eax]              |
|(%eax,%ebx)       |[eax+ebx]          |
|(%ecx,%ebx,2)     |[ecx+ebx*2]        |
|(,%ebx,2)         |[ebx*2]            |
|-10(%eax)         |[eax-10]           |
|%ds:-10(%ebp)     |[ds:ebp-10]        |

## X86_64寄存器

|寄存器名称|gcc约定用途|
|---------|---|
|RAX|返回值|
|RBX|被调用者保护*|
|RCX|第4个参数|
|RDX|第3个参数|
|RSI|第2个参数|
|RDI|第1个参数|
|RBP|被调用者保护|
|RSP|栈指针|
|R8 |第5个参数|
|R9 |第6个参数|
|R10|调用者保护*|
|R11|调用者保护|
|R12|被调用者保护|
|R13|被调用者保护|
|R14|被调用者保护|
|R15|被调用者保护|
|R16|被调用者保护|

*调用者保护*：调用函数之前，寄存器若被使用，其值将会被保存到栈帧。调用完之后恢复。

*被调用者保护*：在子函数中，需要使用这个寄存器的，子函数需要保存这个寄存器的值到栈帧，返回前恢复。

## gcc编译

`-S`会让gcc仅编译c代码，不进行汇编，产出后缀为`.s`的汇编代码文件.

## 零碎运行知识

- 运行同一段程序，只要没有随机跳转的代码，得到的控制流是相同的。

## 涉及内存访问的指令

### 内存读

### 内存写

